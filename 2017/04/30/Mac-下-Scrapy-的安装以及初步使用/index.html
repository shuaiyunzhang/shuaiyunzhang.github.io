<!doctype html>
<html class="theme-next use-motion">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


  <meta name="google-site-verification" content="google65db1e6d85524020.html" />



  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.3.0rc1"/>




    <link rel="alternate" href="/atom.xml" title="Nekonyan's秘密基地" type="application/atom+xml" />



    <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.3.0rc1" />



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?39d05a0d6cdd082f9a0da1f7dd8028d6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  <title> Mac 下 Scrapy 的安装以及初步使用 // Nekonyan's秘密基地 </title>
</head>

<body>
  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
    <a href="/" class="brand">
        <span class="logo">
          <i class="icon-logo"></i>
        </span>
        <span class="site-title">Nekonyan's秘密基地</span>
    </a>
</h1>


  <ul id="menu" class="menu">
    
      
      
        <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          首页
      
        </a>
      </li>
    
      
      
        <li class="menu-item menu-item-about">
        <a href="/about/">
          <i class="menu-item-icon icon-about"></i> <br />
          关于
      
        </a>
      </li>
    
      
      
        <li class="menu-item menu-item-archives">
        <a href="/archives/">
          <i class="menu-item-icon icon-archives"></i> <br />
          归档
      
        </a>
      </li>
    
      
      
        <li class="menu-item menu-item-tags">
        <a href="/tags/">
          <i class="menu-item-icon icon-tags"></i> <br />
          标签
      
        </a>
      </li>
    
      
      
         
      <li class="menu-item menu-item-feed">
        <a href="/atom.xml">
          <i class="menu-item-icon icon-feed"></i> <br />
          
          RSS
      
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              Mac 下 Scrapy 的安装以及初步使用
            
          
        </h1>
      

      <div class="post-meta">
          <span class="post-time">
            
              发表于 2017-04-29
            
          </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2017/04/30/Mac-下-Scrapy-的安装以及初步使用/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/30/Mac-下-Scrapy-的安装以及初步使用/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          <h2 id="1、准备工作">1、准备工作</h2><p>关于 Scrapy 是啥？首先引用<a href="https://doc.scrapy.org/en/latest/intro/overview.html#scrapy-at-a-glance" target="_blank" rel="external">官方文档</a>中的一句话：</p>
<blockquote>
<p>Scrapy is an application framework for crawling web sites and extracting structured data which can be used for a wide range of useful applications, like data mining, information processing or historical archival.</p>
</blockquote>
<p><a href="http://scrapy-chs.readthedocs.io/zh_CN/latest/intro/overview.html#scrapy" target="_blank" rel="external">中文文档</a>的翻译是“ Scrapy 是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中”。</p>
<a id="more"></a>
<p>我的理解就是一种用 Python 写的爬虫。</p>
<p>安装流程基本参照<a href="https://docs.scrapy.org/en/latest/" target="_blank" rel="external">官方文档</a>，附带会借鉴一下网上找到的对我有用的资料（见第四部分：<a href="#reference">参考资料</a>），Python 版本为2.7，安装平台为 macOS 10.12.4，虽然老师在课堂上的建议是使用 ssh 的方式登陆阿里云来进行操作，但鉴于近来经济状况拮据（该死的花呗分期！！！ ┴─┴︵╰（‵□′╰）），不得已在本地环境进行安装与操作。</p>
<h2 id="2、安装以及遇到的问题">2、安装以及遇到的问题</h2><h3 id="1、Python_的安装">1、Python 的安装</h3><p>虽然 Mac 系统自带 Python，但版本比较老旧，Scrapy 目前只支持 Python 2.7 以上和 Python 3.3+ 版本，所以必须下载一个不会和系统冲突的版本，也方便使用<code>pip</code>，由于我以前已经下载过了，这里就不再赘述。</p>
<h3 id="2、虚拟环境配置">2、虚拟环境配置</h3><p><a href="https://virtualenv.pypa.io/en/stable/" target="_blank" rel="external">虚拟环境(virtualenv)</a>也是官方文档中比较推荐的安装 Scrapy 的方式，同时针对 Linux 和 macOS 用户，它还推荐使用<a href="http://virtualenvwrapper.readthedocs.io/en/latest/install.html" target="_blank" rel="external">virtualenvwrapper</a>一种手动工具来创建虚拟环境，因此这里分为两个部分：</p>
<ul>
<li>安装 virtualenv</li>
<li>安装 virtualenvwrapper</li>
</ul>
<h4 id="2-1、安装_virtualen">2.1、安装 virtualen</h4><p>安装命令为：<code>$ [sudo] pip install virtualenv</code>，<strong>这里需要注意的一点是，<code>sudo</code>是可选的，我在实际操作中并没有使用<code>sudo</code></strong>，因此在安装 virtualenvwrapper 时，我的一些参数和使用<code>sudo</code>相比发生了变化，待会做进一步阐述。</p>
<p><img src="http://7vzok8.com1.z0.glb.clouddn.com/installVirtualen.png" alt="安装 virtualen"></p>
<h4 id="2-2、安装_virtualenvwrapper">2.2、安装 virtualenvwrapper</h4><p>安装命令为：<code>$ [sudo] easy_install virtualenvwrapper</code>，同样这里的<code>sudo</code>是可选的，我也没有使用。</p>
<p>问题来了，一般来说使用上面这条命令后，默认会安装在<code>/usr/local/bin</code>下，但实际上并没有，导致我无法使用 virtualenvwrapper，那么问题出在哪儿呢？应该是<code>sudo</code>的问题，在一般情况下，我们都是在 User 的家目录下进行操作，使用<code>su</code>命令后，我们可以切换为 root 用户进行操作，但<strong>并没有离开当前 User 的家目录而切换到 root 的家目录</strong>，<code>sudo</code>命令则会转到 root 的家目录，我一直没有使用<code>sudo</code>命令，也就是说我一直就在 User 的家目录下，virtualenvwrapper 会安装在当前用户的家目录下面，通过查看安装记录，我找到了它，安装在了<code>/Library/Frameworks/Python.framework/Versions......</code>下面。</p>
<p>然后我创建了一个文件夹，用来存放虚拟环境</p>
<pre><code>$ <span class="built_in">mkdir</span> ~/virtualenvworkspaces
$ <span class="built_in">cd</span> ~/virtualenvworkspaces
</code></pre><p>接下来为了使用 virtualenvwrapper，要先运行 virtualenvwrapper.sh 文件，需要设置环境变量，直接在命令行写:</p>
<pre><code>$ export WORKON_HOME=~/virtualenvworkspaces
$ source <span class="regexp">/Library/</span>Frameworks<span class="regexp">/Python.framework/</span>Versions<span class="regexp">/2.7/</span>bin/virtualenvwrapper.sh
</code></pre><p><img src="http://7vzok8.com1.z0.glb.clouddn.com/virtualenvwrapper%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png" alt="设置 virtualenvwrapper 环境变量"></p>
<p>然后我创建了两个虚拟环境 env1 和env2，并切换到 env1 中</p>
<pre><code><span class="variable">$ </span>workon env1
</code></pre><h3 id="3、安装_Scrapy">3、安装 Scrapy</h3><p>根据官方文档的提示，在 Mac 上构建 Scrapy 的依赖库需要 C 编译器以及开发头文件，一般由Xcode提供。</p>
<pre><code>xcode-<span class="built_in">select</span> <span class="comment">--install</span>
</code></pre><p>最后就是安装 Scrapy 了：</p>
<pre><code>pip <span class="keyword">install</span> Scrapy
</code></pre><p><img src="http://7vzok8.com1.z0.glb.clouddn.com/installScrapy.png" alt="安装 Scrapy"></p>
<h2 id="3、初步使用">3、初步使用</h2><p>在看了官方教程的几个例子后，尝试以<a href="http://quotes.toscrape.com/" target="_blank" rel="external">官网例子</a>来抓取热门标签下的名人名言，大致思路是先在首页用选择器选取热门标签元素，然后顺着标签链接进入每个标签页面，再在这个页面爬取每个分页的名人名言信息。代码如下：</p>
<pre><code><span class="keyword">import</span> scrapy


<span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span><span class="params">(scrapy.Spider)</span>:</span>
    name = <span class="string">"quotes"</span>
    start_urls = [<span class="string">'http://quotes.toscrape.com/'</span>]

    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span>
        <span class="comment"># follow links to quote pages</span>
        <span class="keyword">for</span> href <span class="keyword">in</span> response.css(<span class="string">'.tags-box a::attr(href)'</span>).extract():
            <span class="keyword">yield</span> scrapy.Request(response.urljoin(href), callback=self.parse_quotes)

    <span class="function"><span class="keyword">def</span> <span class="title">parse_quotes</span><span class="params">(self, response)</span>:</span>
        tagName = response.css(<span class="string">'h3 a::text'</span>).extract()
        <span class="keyword">for</span> quote <span class="keyword">in</span> response.css(<span class="string">'div.quote'</span>):
            <span class="keyword">yield</span> {
                <span class="string">'tagCate'</span>: tagName,
                <span class="string">'content'</span>: {
                    <span class="string">'text'</span>: quote.css(<span class="string">'span.text::text'</span>).extract_first(),
                    <span class="string">'author'</span>: quote.css(<span class="string">'small.author::text'</span>).extract_first(),
                    <span class="string">'tags'</span>: quote.css(<span class="string">'div.tags a.tag::text'</span>).extract(),
                },
            }

        <span class="comment"># follow pagination links</span>
        next_page = response.css(<span class="string">'li.next a::attr(href)'</span>).extract_first()
        <span class="keyword">if</span> next_page <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:
            next_page = response.urljoin(next_page)
            <span class="keyword">yield</span> scrapy.Request(next_page, callback=self.parse_quotes)
</code></pre><h2 id="4、参考资料">4、<span id="reference">参考资料</span></h2><ol>
<li><a href="https://docs.scrapy.org/en/latest/" target="_blank" rel="external">Scrapy 1.3 documentation — Scrapy 1.3.3 documentation</a></li>
<li><a href="http://scrapy-chs.readthedocs.io/zh_CN/latest/" target="_blank" rel="external">Scrapy 0.25 文档 — Scrapy 0.24.1 文档</a></li>
<li><a href="http://www.mamicode.com/info-detail-1751940.html" target="_blank" rel="external">Scrapy的安装————Windows、linux、mac等操作平台</a></li>
<li><a href="http://www.jianshu.com/p/51140800e8b4" target="_blank" rel="external">详解Mac配置虚拟环境Virtualenv，安装Python科学计算包</a></li>
</ol>

        

      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Python/">
                #Python
              </a>
            
              <a href="/tags/Scrapy/">
                #Scrapy
              </a>
            
              <a href="/tags/爬虫/">
                #爬虫
              </a>
            
          </div>
        

        

        
      </div>
    
  </div>



  
    
      <div class="comments" id="comments">
        <div class="ds-thread" data-thread-key="2017/04/30/Mac-下-Scrapy-的安装以及初步使用/"
             data-title="Mac 下 Scrapy 的安装以及初步使用" data-url="https://nekonyan.me/2017/04/30/Mac-下-Scrapy-的安装以及初步使用/">
        </div>
      </div>
    
  

          </div>

          
        </div>

        

      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2015 - 
  2017
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">nekonyan</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT</a>
</div>



  <div class="cc-license">
    <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
      <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
    </a>
  </div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/dist/jquery.min.js?v=0.3.0rc1"></script>
  <script src="/vendors/jquery/dist/forkme-1.0.js"></script>

  <script type="text/javascript">
      //渲染forkme
      //第一个参数是显示的文本
      //第二个参数是链接地址
      $(document).ready(function(){
        $("body").forkme("View Forkme","https://github.com/shuaiyunzhang");
      });
  </script>
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>



  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      var body = $('body');
      var isSidebarVisible = false;
      var sidebarToggle = $('.sidebar-toggle');
      var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
      var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
      var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
      var sidebar = $('.sidebar');

      var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

      var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
      var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

      var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine2ndStatusArrow = {width: '90%'};
      var sidebarToogleLine2ndStatusClose = {opacity: 0};

      var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
      var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
      var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

      sidebatToggleMotion();
      postsListMotion();
      backToTopMotion();

      function sidebarContentMotion () {
        $('.sidebar .motion-element').velocity(
          'transition.slideRightIn',
          {stagger: 50, drag: true}
        );
      }


      function backToTopMotion () {
        var b2top = $('.back-to-top');
        b2top.on('click', function () {
          body.velocity('scroll');
        });
      }

      function sidebarShowMotion () {
        var sidebarDisplayDuration = 300;
        var sidebarWidth = '320px';

        sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
        sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
        sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

        sidebar.velocity({width: sidebarWidth}, sidebarDisplayDuration);
        isDesktop() && body.velocity({paddingRight: sidebarWidth}, sidebarDisplayDuration);
        sidebarContentMotion();
      }

      function sidebarHideMotion () {
        isDesktop() && body.velocity({paddingRight: 0});
        sidebar.velocity('reverse');

        sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);
      };

      function postsListMotion () {
        $('.post').velocity('transition.slideDownIn', {stagger: 300, drag: true});
      }

      function sidebatToggleMotion () {
        sidebarToggle.on('click', function () {
          isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
          isSidebarVisible = !isSidebarVisible;
        });
        sidebarToggle.hover(function () {
          if (isSidebarVisible) {return}
          sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
          sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
          sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
        }, function () {
          if (isSidebarVisible) {return}
          sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
          sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
          sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
        });
      }

      function isDesktop () {
        return screen.width > 991;
      }

      function isTablet () {
        return screen.width < 992 && screen.width > 767;
      }

      function isMobile () {
        return screen.width < 767;
      }
    });
  </script>

  

  
  
    <script type="text/javascript">
      $(document).ready(function () {
        var html = $('html');

        $('.sidebar-nav li').on('click', function () {
          var item = $(this);
          var activeTabClassName = 'sidebar-nav-active';
          var activePanelClassName = 'sidebar-panel-active';
          if (item.hasClass(activeTabClassName)) {
            return;
          }

          var currentTarget = $('.' + activePanelClassName);
          var target = $('.' + item.data('target'));

          $.Velocity
            .animate(currentTarget, 'transition.slideUpOut', 200)
            .then(function () {
              target
              .velocity('stop')
              .velocity('transition.slideDownIn', 200)
              .addClass(activePanelClassName);
            });

          item.siblings().removeClass(activeTabClassName);
          item.addClass(activeTabClassName);
        });

        $('.post-toc a').on('click', function (e) {
          e.preventDefault();
          var offset = $(this.getAttribute('href')).offset().top;
          html.velocity('stop').velocity('scroll', {
            offset: offset  + 'px',
            mobileHA: false
          });
        });
      });
    </script>
  



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"nekonyan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
  
  <script type="text/javascript">
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-59831850-1');ga('send','pageview');
  </script>

</body>
</html>
